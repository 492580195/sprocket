<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Sprocket - Details</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="sprocket.css">
    <script src="bootstrap/js/bootstrap.min.js"></script>
  </head>
  <body>

    <div class="sprocket-jumbotron">
      <div class="container">
        <a href="index.html">
          <img src="img/sprocket_title.png" class="img-responsive center-block" style="height: 100px;">
        </a>
      </div>
    </div>

    <div class="container">

      <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">

          <h1>Sprocket in details</h1>

<p>In this section, we will discuss a simplified version of Content API’s architecture, what kind of classes exist, the connections between them and what we’ve done in our implementation.</p>

<p>To understand how the different units are implemented both in Content API and in Sprocket engine, and what the connections are between them, we summarized the Content API drawing mechanism in this figure: <a href="img/Content_API.png" rel="nofollow">Content API drawing</a></p>
<p>Here you can see an overview of Sprocket's architecture: <a href="img/Sprocket_High_Level_Diagram.png" rel="nofollow">High-Level</a>, <a href="img/Sprocket_Detailed_Diagram.png" rel="nofollow">Detailed</a>.</p>
<p>In this documentation we will summarize the most important details about Sprocket’s architecture. Under each heading you can read about the relevant classes which the given folder contains.</p>
<h2><a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/app/" rel="nofollow">App</a></h2>
<p>The “app” folder contains the startup dependent classes.</p>
<p>The Content API’s entry point is the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/app/content_main.h&l=68" rel="nofollow">ContentMain</a>. This will start the whole program. We can customize the startup with implementing the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/app/content_main_delegate.h" rel="nofollow">ContentMainDelegate</a> interface. Sprocket’s implementation for ContentMainDelegate is the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/app/main_delegate.h" rel="nofollow">SprocketMainDelegate</a> class.</p>

<p>In Sprocket, the Android and Linux main processes are different, so we have two different paths for them.</p>
<p>On Linux the <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fapp%2Fmain.cc&sa=D&sntz=1&usg=AFQjCNHtuQfUdINGdfBeO4mneH6NCC-JUw" rel="nofollow">main()</a> function is used as an entry point which calls the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/app/content_main.h&l=68" rel="nofollow">ContentMain()</a>, passing our <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/app/main_delegate.h" rel="nofollow">SprocketMainDelegate</a> implementation.</p>
<p>On Android <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fandroid%2Flibrary_loader.cc%23L21&sa=D&sntz=1&usg=AFQjCNF9CS2HsTEkbrsFkZAi5qmvs09z5g" rel="nofollow">Init()</a> will call the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/app/content_main.h&l=62" rel="nofollow">SetContentMainDelegate()</a> with the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/app/main_delegate.h" rel="nofollow">SprocketMainDelegate</a> when the shared lib has been loaded.</p>

<p>In the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/app/content_main_delegate.h" rel="nofollow">ContentMainDelegate</a> we can customize the startup. <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fapp%2Fmain_delegate.cc%23L85&sa=D&sntz=1&usg=AFQjCNHxLVDzd6bOFUjRbePUyyiBwZGhWg" rel="nofollow">Loading resources</a>, <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/app/main_delegate.cc#L42" rel="nofollow">checking the command line</a> flags or <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/app/main_delegate.cc#L42" rel="nofollow">expanding it</a>, <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/app/main_delegate.cc#L42" rel="nofollow">starting processes</a>, etc.</p>
<h2><a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/" rel="nofollow">Browser</a></h2>
<p>The ‘browser’ part of the Content API is the backend for the application which handles all I/O and communication with the child processes. This also talks to the renderer to manage web pages to be painted on the screen.</p>
<p>See: <a href="https://www.chromium.org/developers/design-documents/multi-process-architecture" rel="nofollow"><a href="https://www.chromium.org/developers/design-documents/multi-process-architecture" rel="nofollow">https://www.chromium.org/developers/design-documents/multi-process-architecture</a></a></p>

<p>The <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/app/main_delegate.h#L23" rel="nofollow">SprocketMainDelegate</a> creates <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fapp%2Fmain_delegate.cc%23L42&sa=D&sntz=1&usg=AFQjCNFGVA0SlURJhUN2-88FzAVRVbTwqA" rel="nofollow">clients</a>, in order to customize the content in different process types. The embedder can participate in the browser logic through its <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/content_browser_client.h#L21" rel="nofollow">SprocketContentBrowserClient</a> class.</p>
<p>The browser’s main process is created in <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/app/main_delegate.cc#L60" rel="nofollow">SprocketMainDelegate</a>, and <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fapp%2Fmain_delegate.cc%23L76&sa=D&sntz=1&usg=AFQjCNH-IxRseVWMPyTku4hO7cB61dciRg" rel="nofollow">BrowserMain</a> uses this <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/browser_main_runner.h&l=16" rel="nofollow">BrowserMainRunner</a> to Initialize, Run and Shutdown. The Android port’s logic is different from this, and will be discussed later in the <a href="#heading=h.eog5hq46r41m" rel="nofollow">Android</a> section.</p>
<p>The browser startup process consists of different stages, like EarlyInitialization, MainMessageLoopStart, etc. The <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/browser_main_parts.h&l=50" rel="nofollow">BrowserMainParts</a> class contains these and <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_main_parts.cc%23L93&sa=D&sntz=1&usg=AFQjCNGgqtQBNBG8fWU-2SSGFubuNzWxUw" rel="nofollow">here</a> we initialize the <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/browser_context.h#L19" rel="nofollow">SprocketBrowserContext</a> and create the <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/web_contents.h#L26" rel="nofollow">SprocketWebContents</a>.</p>

<p>The <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/browser_context.h#L19" rel="nofollow">SprocketBrowserContext</a> class holds the context which is required for a browsing session. A typical browser application has two contexts: one for normal browsing and the other for the private/incognito session. <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/browser_context.h#L19" rel="nofollow">SprocketBrowserContext</a> stores information about the nature of the session:</p>
<ul><li>It holds the path of the directory where this context's data is stored.</li>
<li>Is it off-the-record? (also known as “incognito mode”)</li></ul>
<p>... and it gives us a chance to implement various interfaces:</p>
<ul><li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L80&sa=D&sntz=1&usg=AFQjCNEWSfMSi8tA4400dS2TvO5aZSs2zw" rel="nofollow">ZoomLevelDelegate</a>: Maps hostnames to custom zoom levels and persist its information.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L90&sa=D&sntz=1&usg=AFQjCNGZjRjEHHBSo77iXBdzfUd9wVOS2A" rel="nofollow">URLRequestContextGetter</a>: Customization of the main networking behavior.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L119&sa=D&sntz=1&usg=AFQjCNFQSvTiwM9rTMRNpQI5EWt1lh6RjA" rel="nofollow">ResourceContext</a>: It contains the relevant context information required for resource loading.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L124&sa=D&sntz=1&usg=AFQjCNFEJPY35oc4_mjVecW4iu9B9uw6nA" rel="nofollow">DownloadManagerDelegate</a>: Manages all downloads and destination view.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L129&sa=D&sntz=1&usg=AFQjCNGl2-D0cryhAV6X_ktISiN5QhXY_w" rel="nofollow">BrowserPluginGuestManager</a>: Offloads guest management and routing operations outside of the content layer.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L134&sa=D&sntz=1&usg=AFQjCNGQP-xBmtiArCrtvTbWELnndkSFlA" rel="nofollow">SpecialStoragePolicy</a>: Access to the storage subsystems: special rights are granted to 'extensions' and 'applications'.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L139&sa=D&sntz=1&usg=AFQjCNHYt_rcUJ9kFTp6HP6DMGlZe-HyLw" rel="nofollow">PushMessagingService</a>: The Push API uses for talking to push messaging services.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L144&sa=D&sntz=1&usg=AFQjCNF8bt2OwdWXM3TBRBA9Z9j6ePc5cg" rel="nofollow">SSLHostStateDelegate</a>: Encapsulates the host-specific state for SSL errors.</li>
<li><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fbrowser_context.cc%23L148&sa=D&sntz=1&usg=AFQjCNGK-XAt-F0lIkh584yzNA-srqSUMA" rel="nofollow">PermissionManager</a>: Manages feature (e.g. geolocation) permissions (requesting, cancellation, etc...).</li></ul>


<p>The <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/url_request/url_request.h" rel="nofollow">URLRequest</a> class represents the asynchronous load of a data stream from an URL and the <a href="https://www.google.com/url?q=https%3A%2F%2Fcode.google.com%2Fp%2Fchromium%2Fcodesearch%23chromium%2Fsrc%2Fnet%2Furl_request%2Furl_request_context.h%26l%3D51" rel="nofollow">URLRequestContext</a> provides application-specific context for its instances. An embedder can customize the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/url_request/url_request_context.h&l=51" rel="nofollow">URLRequestContext</a> objects through the <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fnet%2Furl_request_context_getter.h%23L34&sa=D&sntz=1&usg=AFQjCNGcdo2k5QEM7KJIpZBwRtFmqNGUBg" rel="nofollow">URLRequestContextGetter</a> interface: <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/url_request/url_request_context_storage.h&l=37" rel="nofollow">Storage</a>, <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/proxy/proxy_service.h&rcl=1430177881&l=46" rel="nofollow">Proxy Service</a>, <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/cert/cert_verifier.h&rcl=1430177881&l=27" rel="nofollow">Cert Verifier</a> (ignore cert error), <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/ssl/ssl_config_service.h&l=25" rel="nofollow">SSL Config Service</a>, <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/dns/host_resolver.h&rcl=1430177881&l=41" rel="nofollow">Host Resolver</a>, <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/http/http_auth_handler_factory.h&rcl=1430177881&l=30" rel="nofollow">Http Auth Handler</a>, <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/cookies/cookie_store.h&rcl=1430192095&l=30" rel="nofollow">Cookie Store</a>, <a href="https://code.google.com/p/chromium/codesearch#chromium/src/net/url_request/http_user_agent_settings.h&rcl=1430192095&l=19" rel="nofollow">User Agent</a>, etc...</p>
<p><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fnet%2Furl_request_context_getter.h%23L34&sa=D&sntz=1&usg=AFQjCNGcdo2k5QEM7KJIpZBwRtFmqNGUBg" rel="nofollow">Sprocket</a> uses the default classes, but we will continuously extend these with custom implementations (e.g. M1: Auth handler).</p>

<p>The <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fweb_contents.h%23L26&sa=D&sntz=1&usg=AFQjCNGblrIZ3ApsOE1JszAdxe0ZX1bBnQ" rel="nofollow">SprocketWebContents</a> class is our wrapper for Chromium’s <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/web_contents.h" rel="nofollow">WebContents</a>. This is the core class in src/content/. It renders web content (usually HTML) in a rectangular area and it will do all the <a href="http://www.chromium.org/developers/design-documents/multi-process-architecture" rel="nofollow">multi-process stuff</a> behind the scenes. In this unit we handle the navigation, toggle fullscreen, open URL, etc. all the web content related operations.
Each WebContents has exactly one <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/navigation_controller.h" rel="nofollow">NavigationController</a>; each NavigationController <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/web_contents.h&l=170" rel="nofollow">belongs</a> to one WebContents. The NavigationController can be obtained from <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/web_contents.h&l=172" rel="nofollow">GetController()</a>, and is used to load URLs into the WebContents, to navigate backwards/forwards in the history, etc.</p>

<p><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow.h&sa=D&sntz=1&usg=AFQjCNGf1bYVOqsAnGXMraj8US-hTkd-og" rel="nofollow">SprocketWindow</a> represents one window, all the UI elements - including buttons and URL bar logic, as well as the web content area. As you might know the browser’s UI is different on Android compared to Linux (for more information check out the <a href="#heading=h.eog5hq46r41m" rel="nofollow">Android</a> section).</p>
<p><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_aura.cc&sa=D&sntz=1&usg=AFQjCNGKZD4_DPQLQ3Rf3e7ylEyAAksI_g" rel="nofollow">On Linux</a> we use <a href="https://www.chromium.org/developers/design-documents/aura/aura-overview" rel="nofollow">Aura</a>. Our <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.h%23L31&sa=D&sntz=1&usg=AFQjCNHVegqP_vKG3LmjCpHSKaUeuf8KkQ" rel="nofollow">View (SprocketWindowDelegateView)</a> is a <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/widget/widget_delegate.h" rel="nofollow">WidgetDelegate</a> - which handles all the window related operations - with a <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/textfield/textfield_controller.h" rel="nofollow">TextfieldController</a> - for the url bar - and a <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/button/button.h" rel="nofollow">ButtonListener</a> - for the buttons as well.</p>
<p>In <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/views_delegate_aura.h" rel="nofollow">SprocketViewsDelegateAura</a> we <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/views_delegate_aura.cc#L32" rel="nofollow">set our native widget</a>, which is the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/widget/desktop_aura/desktop_native_widget_aura.h&l=53" rel="nofollow">DesktopNativeWidgetAura</a>, and the <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/views_delegate_aura.cc#L20" rel="nofollow">default icon</a> and <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/views_delegate_aura.cc#L48" rel="nofollow">application name</a>. </p>
<p>On master branch - which has tab support - the view contains two subviews: a <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftoolbar.h%23L22&sa=D&sntz=1&usg=AFQjCNG2ssUhU1FGAXdLgABBeKOi46LXUA" rel="nofollow">toolbar</a> and a <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftabbed_pane.h%23L25&sa=D&sntz=1&usg=AFQjCNEG2y1Wp_CxU_8dUWd0t8MgNZ5uXg" rel="nofollow">tabbed pane</a>. Sprocket’s UI layout is a simple <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L128&sa=D&sntz=1&usg=AFQjCNFHYl_CmkH32B7kCvtiKXfmuv_TTQ" rel="nofollow">grid</a><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L128&sa=D&sntz=1&usg=AFQjCNFHYl_CmkH32B7kCvtiKXfmuv_TTQ" rel="nofollow"> </a>with two rows. These rows are for the toolbar and the tabbed pane.</p>
<p>The <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftoolbar.h%23L22&sa=D&sntz=1&usg=AFQjCNG2ssUhU1FGAXdLgABBeKOi46LXUA" rel="nofollow">toolbar</a> contains the buttons (<a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftoolbar.cc%23L35&sa=D&sntz=1&usg=AFQjCNET3onBSX7EigC0bq4BM9BMWklV1w" rel="nofollow">back</a>, <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftoolbar.cc%23L44&sa=D&sntz=1&usg=AFQjCNFCSVC4SctF6Wx9e0cU2k8cay5yig" rel="nofollow">forward</a>, <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftoolbar.cc%23L54&sa=D&sntz=1&usg=AFQjCNE0p3_QiYnEEWn4XMAdhvrzWAv5HA" rel="nofollow">refresh and stop</a>) and the <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Ftoolbar.cc%23L54&sa=D&sntz=1&usg=AFQjCNE0p3_QiYnEEWn4XMAdhvrzWAv5HA" rel="nofollow">URL bar</a>. We can define <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L159&sa=D&sntz=1&usg=AFQjCNEI7bM7M78jUR1qrWYG5g_kdGNZ-g" rel="nofollow">accelerators</a> for the UI elements and handle <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L160&sa=D&sntz=1&usg=AFQjCNEstP-CEtheg3cBp47u2Bhk3sKQpA" rel="nofollow">button presses</a>. It is also possible to <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L160&sa=D&sntz=1&usg=AFQjCNEstP-CEtheg3cBp47u2Bhk3sKQpA" rel="nofollow">load</a> the typed URL from the URL bar. A good example how to <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_aura.cc%23L90&sa=D&sntz=1&usg=AFQjCNHN1U4MQ7aD89qYs7EXIFgV1WBAYw" rel="nofollow">c</a><a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_aura.cc%23L90&sa=D&sntz=1&usg=AFQjCNHN1U4MQ7aD89qYs7EXIFgV1WBAYw" rel="nofollow">ontrol</a> which UI element can be enabled can be seen in Sprocket.</p>
<p>The <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tabbed_pane.h#L25" rel="nofollow">tabbed pane</a> contains a <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tabbed_pane.cc#L128" rel="nofollow">scrollview</a> and the contents view. The scrollview contains the tabs within a <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tabbed_pane.cc#L34" rel="nofollow">tab strip</a> and a <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tabbed_pane.cc#L240" rel="nofollow">new tab button</a>. The contents view’s child views are the webviews associated with the <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tab.h#L23" rel="nofollow">tabs</a>. When a <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tabbed_pane.cc#L171" rel="nofollow">tab gets selected</a>, the associated child view of the contents view becomes visible. <a href="https://github.com/szeged/sprocket/blob/0db915417cefadab977b2a5c0df11d33b0961f22/browser/ui/tabbed_pane.cc#L157" rel="nofollow">Adding a tab</a> consists of two steps: adding a tab as a child view to the tabstrip, and adding the tab’s content view as a child view to tabbed pane’s contents. The tab’s content view is a <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L20&sa=D&sntz=1&usg=AFQjCNEuXDnVCwB8UMzIpQw7V7NaMDq_nA" rel="nofollow">web view</a>, which has a <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L21&sa=D&sntz=1&usg=AFQjCNFbhNMedIMefZWbb1y6NWbyi4xrAQ" rel="nofollow">web content</a>.</p>
<p>The <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fbrowser%2Fui%2Fwindow_delegate_view_aura.cc%23L67&sa=D&sntz=1&usg=AFQjCNF9naqjNRhdQK7XQ4hddRaKGIt9uA" rel="nofollow">context menu</a> has the same functionality as the buttons. It can be extended, and we are planing to add the the cut, copy and paste functions to the context menu.</p>
<p>On core and testing branch there is no toolbar or tabbed pane. The window uses a <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window_delegate_view_aura.cc#L46" rel="nofollow">FillLayout</a> to stretch its content, which is the web view.</p>
<h2><a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/renderer/" rel="nofollow">Renderer</a></h2>
<p>Currently Sprocket has no renderer folder, because we use the default implementation of these classes. In M2 we will extend this to show how easily you can add new features.</p>
<p>Sprocket specific code that runs in the renderer process could be put here. Features like auto fill, translate, etc. can be added to the content module with extension of these classes</p>
<h2><a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/common/" rel="nofollow">Common</a></h2>
<p>You can find here those files which are shared between the multiple processes (i.e. browser and renderer, renderer and plugin, etc...). Here you can declare constants, switches, favicon, etc, basically everything you will need to access from all processes.</p>
<p>Currently Sprocket <a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fszeged%2Fsprocket%2Fblob%2F0db915417cefadab977b2a5c0df11d33b0961f22%2Fcommon%2Fcontent_client.h&sa=D&sntz=1&usg=AFQjCNFKVteQcKn2_NJ-MsI2uomfrAfoQA" rel="nofollow">implements</a> only the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/common/content_client.h&l=68" rel="nofollow">ContentClient</a>.</p>
<h2><a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/android/" rel="nofollow">Android</a></h2>
<p><a href="https://github.com/szeged/sprocket/tree/master/android" rel="nofollow">In this folder</a> you can find source codes for the Android port’s implementation. The code of an Android application is based on Java. Most of the Content API is written in C++, but to work with Android, it has Java (JNI) bindings. Fortunately with <a href="http://en.wikipedia.org/wiki/Java_Native_Interface" rel="nofollow">JNI</a> we can call C++ functions and vica versa. To make this work, you need to <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/library_loader.cc#L33" rel="nofollow">bind</a> the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/library_loader.cc#L21" rel="nofollow">Init</a> and <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/library_loader.cc#L17" rel="nofollow">RegisterJNI</a> functions. This will be called when the shared library is loaded first.</p>
<p>We have defined some <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/manager.h" rel="nofollow">helper functions</a> which will provide a bridge between the java and C++ code. It is not a hard requirement, but could be handy.</p>
<p>The following part requires some knowledge about Android. If you are new in this topic, we can suggest to read this basic <a href="https://developer.android.com/training/basics/firstapp/index.html" rel="nofollow">tutorial </a>at least. If you know the following terms it will be easy to follow us in this part of the documentation: <a href="https://developer.android.com/tools/help/sdk-manager.html" rel="nofollow">SDK Manager</a>, <a href="http://en.wikipedia.org/wiki/Android_application_package" rel="nofollow">Apk</a>, <a href="https://developer.android.com/tools/devices/index.html" rel="nofollow">AVD</a>, <a href="https://developer.android.com/guide/components/fundamentals.html" rel="nofollow">Application</a>, <a href="https://developer.android.com/guide/components/activities.html" rel="nofollow">Activities</a>, <a href="https://developer.android.com/guide/topics/resources/overview.html" rel="nofollow">Resources</a>, <a href="https://developer.android.com/guide/topics/manifest/manifest-intro.html" rel="nofollow">Manifest</a>, <a href="https://developer.android.com/reference/android/widget/LinearLayout.html" rel="nofollow">LinearLayout</a>, <a href="https://developer.android.com/reference/android/widget/EditText.html" rel="nofollow">EditText</a>, <a href="https://developer.android.com/reference/android/widget/Button.html" rel="nofollow">Button</a>, <a href="http://developer.android.com/reference/android/widget/FrameLayout.html" rel="nofollow">FrameLayout</a>, <a href="https://developer.android.com/guide/components/intents-filters.html" rel="nofollow">Intent</a>, <a href="https://developer.android.com/reference/android/content/Context.html" rel="nofollow">Context</a>.</p>
<p>Implemented java classes:</p>
<ul><li><a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketApplication.java" rel="nofollow">Application</a>: Entry point of the Sprocket application.  Handles initialization of information that needs to be shared across the main Activity and the created child services.</li>
<li><a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java" rel="nofollow">Activity</a>:  Activity for managing the SprocketWindow.</li>
<li><a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/java/src/hu/uszeged/sprocket/SprocketManager.java" rel="nofollow">Manager</a>: Container and generator of the views.</li>
<li><a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/java/src/hu/uszeged/sprocket/SprocketWindow.java" rel="nofollow">Window</a>: Container for various UI components that make up a window. (Currently we support only one window.)</li></ul>

<p>Although in general there is no need to subclass <a href="http://developer.android.com/reference/android/app/Application.html" rel="nofollow">Application,</a> but we will need to load our dependencies (paks) and initialize the command line. The entry point of the Content API can be found <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/android/java/src/org/chromium/content/app/ContentApplication.java" rel="nofollow">here</a>.</p>
<p>Our <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java" rel="nofollow">Activity</a> redefines the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L50" rel="nofollow">onCreate</a> and <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L177" rel="nofollow">onStart</a> methods of the <a href="http://developer.android.com/reference/android/app/Activity.html#ActivityLifecycle" rel="nofollow">Activity Lifecycle</a>.</p>
<p>On Create: the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L53" rel="nofollow">command line initialization</a> has to be done before loading the library, because we need to pass the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L55" rel="nofollow">command line arguments</a> first. After that, the engine tries to load the native <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L64" rel="nofollow">libraries</a> with help of the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/base/android/java/src/org/chromium/base/library_loader/LibraryLoader.java&q=libraryloader.java&sq=package:chromium&type=cs&l=42" rel="nofollow">LibraryLoader</a>. If it <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L66" rel="nofollow">fails</a>, nothing can work, so we have to <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L69" rel="nofollow">kill the whole application</a>, not just the activity. After loading the libraries we create the <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/java/src/hu/uszeged/sprocket/SprocketManager.java" rel="nofollow">Manager</a> - also <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/java/src/hu/uszeged/sprocket/SprocketManager.java#L49" rel="nofollow">create</a> a <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/manager.cc#L51" rel="nofollow">C++ reference</a> of it - and the Activity Window. Next, we <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/java/src/hu/uszeged/sprocket/SprocketManager.java#L33" rel="nofollow">get</a> the startup URL and if it is <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L85" rel="nofollow">not empty</a>, we <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L86" rel="nofollow">replace</a> our default<a href="https://github.com/szeged/sprocket/blob/master/android/java/src/hu/uszeged/sprocket/SprocketManager.java#L33" rel="nofollow"> </a>URL. And finally we can <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L92" rel="nofollow">start</a> the browser process. If the startup fails, we <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L118" rel="nofollow">notify</a> the user. If succeed, we <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L115" rel="nofollow">launch</a> the web contents, which basically <a href="https://github.com/szeged/sprocket/blob/master/android/manager.cc#L63" rel="nofollow">creates</a> a SprocketWindow and a SprocketWebContents. This is where <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/java/src/hu/uszeged/sprocket/SprocketManager.java#L132" rel="nofollow">Java</a> calls a <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/manager.cc#L60" rel="nofollow">C++</a> function. For now, if we have an active window, we close it, and open a new one with the URL which was set before. There should not be any active window when onCreate is called, but there is a <a href="http://developer.android.com/reference/android/app/Activity.html#ActivityLifecycle" rel="nofollow">corner case (left side)</a>.</p>
<p>OnStart: We should <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L180" rel="nofollow">have</a> an active content view, so let’s <a href="https://github.com/szeged/sprocket/blob/f998f1bf50454636d42a0efa115c9e14a5b8f8a5/android/sprocket_apk/src/hu/uszeged/sprocket_apk/SprocketActivity.java#L181" rel="nofollow">show</a> it.</p>
<p>After this, we should have the browser up, and the Window will handle all the UI interactions.</p>

          <hr>

      <footer>
        <div class="row">
          <div class="col-md-6">
            <p>&copy; 2016 University of Szeged, DSE; Sprocket Team</p>
          </div>
          <div class="col-md-6 license-button-container">
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
              <img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
            </a>
          </div>
        </div>
      </footer>

        </div>
        <div class="col-sm-2"></div>
      </div>

    </div> <!-- /container -->

  </body>
</html>
