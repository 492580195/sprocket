<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Sprocket - Tutorials</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="sprocket.css">
    <script src="bootstrap/js/bootstrap.min.js"></script>
  </head>
  <body>

    <div class="sprocket-jumbotron">
      <div class="container">
        <a href="index.html">
          <img src="img/sprocket_title.png" class="img-responsive center-block" style="height: 100px;">
        </a>
      </div>
    </div>

    <div class="container">

      <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">

          <h1>Tutorials</h1>

<p>These are detailed descriptions of specific features as addition for the "<a href="sprocket_in_details.html">Sprocket in details</a>" overview. Check out our blog for <a href="http://browser.sed.hu/category/keywords/sprocket">step-by-step tutorials</a>.</p>

<h2><a href="https://www.chromium.org/developers/design-documents/sandbox" rel="nofollow">Sandbox</a></h2>
<p>By default, we <a href="https://github.com/szeged/sprocket/blob/207d7ebdd6d5fbe7ac18f7ed8de64ffe83397e7b/main_delegate.cc#L28" rel="nofollow">disable</a> the sandbox feature.</p>
<p>In this tutorial (guide?), we will show how to add the sandbox feature.</p>
<p>First, we will need a command line switch to enable the sandbox. Let’s add our <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/common/switches.h" rel="nofollow">switches file</a> to the <a href="https://github.com/szeged/sprocket/tree/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/common" rel="nofollow">common</a> directory, so we could access it from the entire application. Next, we need to <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/common/switches.cc#L11" rel="nofollow">define </a>the switch: “use-sandbox”. By default, we <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/app/main_delegate.cc#L44" rel="nofollow">disable</a> the sandbox mode, and only enable it when the use-sandbox flag is <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/app/main_delegate.cc#L43" rel="nofollow">set</a>. The <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/app/main_delegate.cc#L42" rel="nofollow">browser process</a> will handle these command line flags.</p>
<p>Finally, we need to add the sandbox <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/sprocket.gyp#L170" rel="nofollow">target</a>, and here is a guide <a href="https://github.com/szeged/sprocket/blob/668eeed3d62c3fadf62c9edd5ec29d4772c2fd91/README.md#sandbox-linux" rel="nofollow">how to use it</a>.</p>
<p>Now if we use the --use-sandbox command line argument, the application will run in sandboxed mode.</p>
<p>On Android, sandboxing is default. With version 4.1 (Jelly Bean), a new feature has been added to Android, it is called <a href="http://developer.android.com/guide/topics/manifest/service-element.html#isolated" rel="nofollow">process isolation</a>. Setting a process isolated means, that it will not have any permissions on its own, and it is isolated from the rest of the system. For instance an isolated process can only read the files / folders from the APK itself, but can not read any other data which is on the external or internal storage of the device. To sandbox a process on Android, you can set the <a href="https://github.com/szeged/sprocket/blob/b2b53a0ef8b22717cd9ea39fa8ec586ffb2bd30e/android/sprocket_apk/AndroidManifest.xml.jinja2#L50" rel="nofollow">android:isolatedProcess=true</a> on the specified process. In Sprocket, this method is used for sandboxing.</p>






<h2>Fullscreen support</h2>
<h3>Linux</h3>
<p>To support fullscreen mode, first, some <a href="https://code.google.com/p/chromium/codesearch#chromium/src/content/public/browser/web_contents_delegate.h&q=webcontentsdelegate&sq=package:chromium&type=cs&l=71" rel="nofollow">WebContentsDelegate</a> methods should be overridden in our <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/web_contents.h" rel="nofollow">SprocketWebContents</a> class. These methods are the following:</p>
<ul><li><a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/web_contents.h#L81" rel="nofollow">EnterFullscreenModeForTab</a>(...)</li>
<li><a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/web_contents.h#L83" rel="nofollow">ExitFullscreenModeForTab</a>(...)</li>
<li><a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/web_contents.h#L84" rel="nofollow">IsFullscreenForTabOrPending</a>(...)</li></ul>
<p>These methods are called from the Content API when a website requests to be (or not to be anymore) in full screen: for example when the fullscreen button is pressed on a HTMLVideoElement. In the Enter… and Exit… methods the resizing behaviors can be configured. Besides Content API requesting the fullscreen view, the user should be able to toggle fullscreen mode as well. In Sprocket, this is possible with pressing the F11 key. The key event gets catched in <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/web_contents.cc#L171" rel="nofollow">SprocketWebContents::HandleKeyboardEvent</a> method and it is delegated to <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window_delegate_view_aura.cc#L99" rel="nofollow">SprocketWindowDelegateView</a> which does the handling.</p>
<p>There is another method which plays a key role in the full screen toggling: <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window_aura.cc#L81" rel="nofollow">PlatformToggleFullscreenModeForTab</a>. It is important to save the fullscreen state of the window, before toggling to fullscreen mode on a website, because after switching to non-fullscreen view, the same state as before should be restored. For example, when a video is being watched, the user can toggle the <i>window </i>to fullscreen mode, but not the <i>video</i>. After this, the user can toggle the <i>video</i> to fullscreen as well. After switching to a non-fullscreen video mode, it is important that the <i>window</i> stays fullscreen, because only the <i>video</i> was toggled. To solve this problem, we added a <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window.h#L99" rel="nofollow">was_fullscreen</a> variable to SprocketWindow’s implementation. Another common case is, when the user sets the window and the video to full screen at the same time. In this case, when the <i>window</i> fullscreen mode gets toggled off, the <i>video</i> (web content) should be toggled to normal mode as well. This logic is also implemented in <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window_aura.cc#L86" rel="nofollow">PlatformToggleFullscreenModeForTab</a>. The current states of the window and webcontents are kept in the <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window.h#L98" rel="nofollow">is_fullscreen</a> variable in SprocketWindow and SprocketWebContents.</p>
<p>The above description applies for all branches. The difference in the implementation between core (testing) and master branch is in SprocketWindowDelegateView class. This class is responsible for the UI layout.</p>
<p>So first, let’s see, how it works on core and testing branch, because it’s the simpler way. The window’s layout is a simple <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window_delegate_view_aura.cc#L24" rel="nofollow">FillLayout</a>, which is completely filled with the WebView. To toggle fullscreen mode it is enough to call <a href="https://github.com/szeged/sprocket/blob/812db6836fa5df94f306769ad59ab696f6164f18/browser/ui/window_aura.cc#L85" rel="nofollow">SetFullscreen(bool fullscreen)</a> on the windowWidget.</p>
<p>On master Sprocket, toggling fullscreen mode is more complicated because the task is not just to stretch a FillLayout  to fullscreen, but to rearrange the whole layout in order to hide the toolbar, tabs, etc. To completely understand our solution, first you should have read the above <i>Browser </i>section. When fullscreen layout is <a href="https://github.com/szeged/sprocket/blob/6e217e44a8f8bbac7ce64e13ee8ec584ea4aa43a/browser/ui/window_delegate_view_aura.cc#L178" rel="nofollow">requested</a>, the gridView should be removed and replaced by the webView. When normal layout is <a href="https://github.com/szeged/sprocket/blob/6e217e44a8f8bbac7ce64e13ee8ec584ea4aa43a/browser/ui/window_delegate_view_aura.cc#L185" rel="nofollow">requested</a>, the webView is removed and replaced by the gridView.</p>

<h3>Android</h3>
<p>On Android, the case is much simpler, because toggling the browser window to fullscreen is not an option on mobile browsers, so we only have to deal with toggling of the webcontents which was already described in the Linux section above.</p>






<h2>Tab support (Linux)</h2>
<p>To support multiple browsing tabs, you can use the classes from <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/tabbed_pane/" rel="nofollow">ui/view/controls/tabbed_pane/</a>. These classes contain the most important features regarding tab support, but they need some customization for the proper use. So the simplest way is to implement these classes yourself, so that you can keep the implemented features and extend them in your own way. Three classes play the key role in tab support: <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L25" rel="nofollow">TabbedPane</a>, <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.h#L23" rel="nofollow">Tab</a>, <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L34" rel="nofollow">TabStrip</a>. TabbedPane contains a <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L88" rel="nofollow">tab strip</a> and the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L89" rel="nofollow">contents view</a>. TabStrip contains the tabs as its child views, and the contents view's child views are the webviews associated with each tab.</p>
<p>TabStrip is just a simple View subclass which contains unique <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L63" rel="nofollow">size</a> and <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L73" rel="nofollow">layout</a> calculations. </p>
<p>Tab represents a tab with its header and <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.h#L65" rel="nofollow">content view</a> (webview). It contains a reference to the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.h#L59" rel="nofollow">tabbed pane</a> which contains it, and also a reference to its associated content view. We also added a <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.h#L67" rel="nofollow">SprocketWebContents</a> member to the Tab class so that it could keep track of its own web content (back, forward, stop, load URL, etc). If you prefer, you can also add a <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.h#L60" rel="nofollow">close button</a> to the Tab, but then you should change the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.cc#L82" rel="nofollow">Layout()</a> method. You can configure your tab's size in <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.cc#L78" rel="nofollow">GetPreferredSize()</a> function. You can use dynamically changing widths, or just use constants. If you're looking for a simple solution you can put the TabStrip into a <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L128" rel="nofollow">ScrollView</a> and return constant sizes in this method. Originally there is no accessor provided to Tab's <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.h#L61" rel="nofollow">title</a> member, so dynamic title changes are not supported. You can provide a <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tab.cc#L51" rel="nofollow">setter</a> in order to support this.</p>
<p>TabbedPane is the class that is responsible for most of the tab related functions. It manages the tabs in the TabStrip and the associated content views. It ensures the non-null 1:1 relationship between content views and tabs. TabbedPane is responsible for tab additions, selections and closing. Tab closing is not supported originally, you can implement your custom function for it. <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L198" rel="nofollow">Here</a> you can find our example. If you added a close button to the Tab, you should <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L26" rel="nofollow">extend</a> the ButtonListener class in TabbedPane as well, and <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L298" rel="nofollow">override</a> ButtonPressed(...) method in order to catch the proper event. <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L55" rel="nofollow">GetTabAt(int index)</a> method is private originally, but it can be modified to be public, because in some cases it is necessary to call it from outside. We extracted the accelerator addition to a separate method called <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L232" rel="nofollow">InitAccelerators()</a>. In <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L264" rel="nofollow">AcceleratorPressed(...)</a> method you can bind other behaviours to specific key presses, but first you have to add the proper accelerator in InitAccelerators(). In order to get the window resizing to work correctly, <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L283" rel="nofollow">PreferredSizeChanged()</a> method should be overridden, and you should provide the correct size calculations of the tab associated webviews. In our case we set all of the tabs webview’s sizes to <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L289" rel="nofollow">match</a> the selected tab's webview's size. You should also modify <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L217" rel="nofollow">GetPreferredSize()</a> function: it's not necessary to calculate the <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/tabbed_pane/tabbed_pane.cc&l=333" rel="nofollow">maximum</a> size of the content views, you can use the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L221" rel="nofollow">selected</a> tab's content view's size. We added an <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L91" rel="nofollow">extra button</a> to the tabstrip for opening new tabs. If you do this our way, you should change the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L143" rel="nofollow">GetTabCount()</a> method, because now tab_strip_->child_count() won't be equal to contents_->child_count(), you should write <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L144" rel="nofollow">tab_strip_->child_count() - 1</a> instead. (Because the new tab button is also a child view of the tab strip, but has no associated content view.) You should also <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L299" rel="nofollow">differentiate</a> two cases in ButtonPressed() method, based on who the sender is (new tab or close tab button).</p>
<p>You should also remove the early return from <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/tabbed_pane/tabbed_pane.cc&l=304" rel="nofollow">SelectTabAt(int index)</a>, because it can create confusing situations in case of tab deletion (you delete a selected tab, and the tab that comes in place of the deleted should be selected, but the index stays the same). Also when implementing the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L198" rel="nofollow">tab closing</a> you should take care of different cases (<a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L206" rel="nofollow">selected tab deletion</a>, which tab can come to its place, unselected tab deletion). You should consider a unified behavior to simplify your implementation. In our case when a selected tab gets deleted and it has other tabs on the right, then the tab on its right will replace it, if it is the rightmost tab, then the tab on its left becomes selected. If unselected tab gets deleted then the selected tab remains the same.</p>
<p>As mentioned before you can choose to put the tab strip into a scroll view instead of dynamic tab width changing, that is what we are using as well. In this case you should take care of the proper size calculations in <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L246" rel="nofollow">Layout()</a>. In the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L251" rel="nofollow">scrollview size calculation</a> you should consider different cases: tab scrollbar is shown or not. In the content view size calculation you should use the <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L259" rel="nofollow">previously calculated scrollview height</a>.</p>
<p>There is a fourth class that should be used, that's <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/tabbed_pane/tabbed_pane_listener.h&l=14" rel="nofollow">TabbedPaneListener</a>. It is an abstract class so some of your own classes should extend it. TabbedPane has a <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.h#L84" rel="nofollow">reference</a> to a listener and it can communicate with the rest of the application through it. Originally it has one method: <a href="https://code.google.com/p/chromium/codesearch#chromium/src/ui/views/controls/tabbed_pane/tabbed_pane_listener.h&l=17" rel="nofollow">TabSelectedAt(int index)</a>. When a tab gets selected, TabbedPane <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane.cc#L190" rel="nofollow">calls</a> this method on it's listener, in order to perform certain operations depending on tab selection. We <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane_listener.h#L12" rel="nofollow">expanded</a> the listener interface with two other methods: <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane_listener.h#L16" rel="nofollow">LastTabClosed()</a> and <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/tabbed_pane_listener.h#L17" rel="nofollow">OpenNewEmptyTab()</a>. For example, the first method is necessary because it lets <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/window_delegate_view_aura.cc#L109" rel="nofollow">SprocketWindowDelegateView</a> know that the last tab has been closed, so it can call specific methods in order to close the whole window.</p>
<p>Besides these classes you should also modify your existing code. You should add methods to the window class regarding tab <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/window_aura.cc#L66" rel="nofollow">addition</a> and <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/ui/window_aura.cc#L72" rel="nofollow">selection</a>. Before implementing the tab support the SprocketWebContents instance belonged to the SprocketWindowDelegateView, now it should belong to the tab.</p>
<p>The navigation controls, URL bar and window title should also change in regard of the selected tab. Therefore you should check if the tab is selected before <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/web_contents.cc#L90" rel="nofollow">updating the navigation controls</a>, <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/web_contents.cc#L150" rel="nofollow">setting the title</a> or <a href="https://github.com/szeged/sprocket/blob/93a988605622e2f619e6c684425029c2f5558902/browser/web_contents.cc#L234" rel="nofollow">setting the text of the url bar</a>.</p>

          <hr>

      <footer>
        <div class="row">
          <div class="col-md-6">
            <p>&copy; 2016 University of Szeged, DSE; Sprocket Team</p>
          </div>
          <div class="col-md-6 license-button-container">
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
              <img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
            </a>
          </div>
        </div>
      </footer>

        </div>
        <div class="col-sm-2"></div>
      </div>

    </div> <!-- /container -->

  </body>
</html>
